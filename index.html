<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>제주 맛집 지도</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>제주 맛집 지도</h1>
        </header>
        
        <div class="controls">
            <button id="loadDataBtn" class="btn-primary">데이터 불러오기</button>
            <div class="info">
                <span id="restaurantCount">0개의 음식점</span>
            </div>
            <div class="legend">
                <span class="legend-title">매출 4분위 범례:</span>
                <span class="legend-item">데이터 로드 후 표시됩니다</span>
            </div>
        </div>
        
        <div id="map" class="map-container">
            <button id="myLocationBtn" class="my-location-btn" title="내 현재 위치로 이동">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 8C9.79 8 8 9.79 8 12C8 14.21 9.79 16 12 16C14.21 16 16 14.21 16 12C16 9.79 14.21 8 12 8ZM20.94 11C20.48 6.83 17.17 3.52 13 3.06V1H11V3.06C6.83 3.52 3.52 6.83 3.06 11H1V13H3.06C3.52 17.17 6.83 20.48 11 20.94V23H13V20.94C17.17 20.48 20.48 17.17 20.94 13H23V11H20.94ZM12 19C8.13 19 5 15.87 5 12C5 8.13 8.13 5 12 5C15.87 5 19 8.13 19 12C19 15.87 15.87 19 12 19Z" fill="currentColor"/>
                </svg>
            </button>
        </div>
        
        <div id="infoPanel" class="info-panel collapsed">
            <h3>음식점 정보</h3>
            <div id="restaurantInfo"></div>
        </div>
    </div>
    
    <!-- 환경 변수 설정 (빌드 시 자동 생성) -->
    <script src="config.js"></script>
    <!-- Google Maps API -->
    <script>
        // config.js에서 API 키를 읽어와 동적으로 로드
        (function() {
            const apiKey = window.APP_CONFIG?.GOOGLE_MAPS_API_KEY || '';
            if (!apiKey || apiKey === 'YOUR_GOOGLE_MAPS_API_KEY') {
                console.error('❌ Google Maps API 키가 설정되지 않았습니다. 환경 변수를 확인해주세요.');
                document.body.innerHTML = '<div style="padding: 20px; text-align: center;"><h2>설정 오류</h2><p>Google Maps API 키가 설정되지 않았습니다.<br>환경 변수 GOOGLE_MAPS_API_KEY를 확인해주세요.</p></div>';
                return;
            }
            
            // Google Maps API 로드 완료 콜백 함수 설정
            window.initGoogleMaps = function() {
                // API 로드 완료 후 app.js의 initMap 호출
                if (typeof initMap === 'function') {
                    initMap();
                }
            };
            
            const script = document.createElement('script');
            // loading=async 파라미터 추가 및 callback 설정
            script.src = `https://maps.googleapis.com/maps/api/js?key=${apiKey}&libraries=places&loading=async&callback=initGoogleMaps`;
            script.async = true;
            script.defer = true;
            script.onerror = function() {
                console.error('❌ Google Maps API를 로드할 수 없습니다.');
                document.body.innerHTML = '<div style="padding: 20px; text-align: center;"><h2>로드 오류</h2><p>Google Maps API를 로드할 수 없습니다.<br>네트워크 연결과 API 키를 확인해주세요.</p></div>';
            };
            document.head.appendChild(script);
        })();
    </script>
    <script src="app.js"></script>
</body>
</html>

